<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.16.22/dist/css/uikit.min.css" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Roombot</title>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.22/dist/js/uikit.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.22/dist/js/uikit-icons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r126/three.js"
            integrity="sha512-aPhrlLlp7Mr8g+MVw6/wMD8PjqqzRNhSM8pHDyyJPmUTJMzKxMmxrjauzQforOaAegN3CIKUTKXJyLwFD57RtA=="
            crossorigin="anonymous"></script>

</head>
<body>
    <a href="/" style="position: relative;left: 40pc;top: 3.9pc;color: black;"><span class="uk-margin-small-right" uk-icon="icon: home"></span></a>
    <button class="uk-button uk-button-default uk-margin-small-right" type="button" uk-toggle="target: #offcanvas-nav-primary" style="position: relative;top: 4pc;left: 48pc;border: none;">
        <i class="fa fa-bars" aria-hidden="true"></i>
    </button>

<div id="offcanvas-nav-primary" uk-offcanvas="overlay: true">
    <div class="uk-offcanvas-bar uk-flex uk-flex-column">

        <ul class="uk-nav uk-nav-primary uk-nav-center uk-margin-auto-vertical">
            <li class="uk-active"><a href="#"> Keep on dreaming even if it break your heart! </a></li>
            <li class="uk-nav-header">Header</li>
            <li class="uk-nav-divider"></li>
            <li><a href="/user/imovies" title="movies"><span class="uk-margin-small-right" uk-icon="icon: play-circle"></span> Movies </a></li>
            <li><a href="/user/library" title="music"><span class="uk-margin-small-right" uk-icon="icon: play"></span> Playlist </a></li>
            <li><a href="/user/library/books" title="library"><span class="uk-margin-small-right"></span> <i class="fa fa-book" aria-hidden="true"> Libraries </i> </a></li>
            <li><a href="/user/composer" title="creation"><span class="uk-margin-small-right" uk-icon="icon: cloud-upload"></span> Music </a></li>
        </ul>
    </div>
</div>

<div class="uk-container" style="position: relative;top: 9pc;left: 3pc;width: 33pc;height: 11pc;">
    <form method="post" action="/user/library/{searchbycollection}" style="position: relative;width: 20pc;height: 8pc;left: 0pc;">
        <input type="text" placeholder="Search song from collection" name="song" class="uk-form-success" id="songbar" style="position: relative;left: 10pc;width: 33pc;height: 2pc;border-radius: 2pc;border: 1px;">
        <button class="uk-button-dark" title="search" type="submit" style="position: relative;top: -1.8pc;left: 38pc;border: none;background: transparent;">
            <span class="uk-margin-small-right" uk-icon="icon: search"></span>
        </button>
        <button class="uk-button-dark" type="button" style="position: relative;top: -1.8pc;left: 32pc;border: none;background: transparent;">
            <span class="uk-margin-small-right" uk-icon="icon: thumbnails"></span>
        </button>
        <div uk-dropdown="mode: click" style="border-radius: 2pc;">
            <button class="uk-button-default" uk-toggle="target: #artist" type="button" title="Artist" style="border: none;background: transparent;">
                <span class="uk-margin-small-right" uk-icon="icon: users"></span>
            </button>
            <button class="uk-button-default"  uk-toggle="target: #emotion" type="button" title="Your emotion" style="border: none;background: transparent;">
                <span class="uk-margin-small-right" uk-icon="icon: heart"></span>
            </button>
            
            
            <div id="artist" uk-modal>
                <div class="uk-modal-dialog uk-modal-body" style="border-radius: 2pc;">
                    <h2 class="uk-modal-title"></h2>
                    <button class="uk-modal-close-full uk-close-large" type="button" style="border: none; background: transparent;" uk-close></button>
                        <form class="_f0a" method="post" action="/user/library/{search}/{artist}">
                            <input class="uk-input" type="text" name="artist" placeholder="Your eyes looking for ? " id="artistbar" style="position: relative; top: 2pc; border-radius: 2pc;">
                            <span class="uk-margin-small-left" uk-icon="icon: users" style="position: relative; top: -3pc;"></span>
                            <button type="submit" class="uk-button-dark" title="submit" style="position: relative;left: 28pc;border: none;background: transparent;top: -0.5pc;">
                                <span class="uk-margin-small-right" uk-icon="icon: database"></span>
                            </button>
                            <button class="uk-button uk-button-dark" type="button" id="microphone_1" title="say artist" style="position: relative;border: none;background: transparent;left: 20pc;top: -0.5pc;">
                                <span class="uk-margin-small-right" uk-icon="icon : microphone"></span>
                            </button>
                        </form>
                </div>
            </div>
    
            <div id="emotion" uk-modal>
                <div class="uk-modal-dialog uk-modal-body" style="border-radius: 2pc;">
                    <h2 class="uk-modal-title"></h2>
                    <button class="uk-modal-close-full uk-close-large" type="button" style="border: none; background: transparent;" uk-close></button>
                        <form class="_f0b" method="post" action="/user/library/{search}/{music}/{emotion}">
                            <input class="uk-input" type="text" name="emotion" placeholder="add your emotion?" id="emotionbar" style="position: relative; top: 2pc; border-radius: 2pc;top: -0.5pc;">
                            <span class="uk-margin-small-left" uk-icon="icon: heart" style="position: relative; top: -5pc;"></span>
                            <button type="submit" class="uk-button-dark" title="submit" style="position: relative; left: 28pc; background: transparent; border: none; top : -3pc;">
                                <span class="uk-margin-small-right" uk-icon="icon: database"></span>
                            </button>
                            <button class="uk-button uk-button-dark" type="button" id="microphone_2" title="say emotion" style="position: relative;border: none;background: transparent;left: 20pc;top: -3pc;">
                                <span class="uk-margin-small-right" uk-icon="icon : microphone"></span>
                            </button>
                        </form>
                </div>
            </div> 
        </div>

        <button class="uk-button uk-button-dark" type="button" id="microphone" title="say song" style="position: relative;top: -8pc;left: 40pc;border: none;background: transparent;">
            <span class="uk-margin-small-right" uk-icon="icon : microphone"></span>
        </button>
        
    </form>
 </div>
 <div class="uk-container" id="audio"></div>
 <script>

    function get_microphone_credentials(){

        navigator.mediaDevices.getUserMedia({
            audio : true,
            video : false,
        }).then((stream)=>{

            window.localStream = stream;
        }).catch((error)=>{

            console.log("Error :",error);
        });
    }


    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const SpeechGrammarList = window.SpeechGrammarList || window.webkitSpeechGrammarList;
    const SpeechRecognitionEvent = window.SpeechRecognitionEvent || window.webkitSpeechRecognitionEvent;

    const commands = [
        "search",
        "artist",
        "emotion",
    ];


    const grammar = `#JSGF V1.0; grammar commands; public<command> = ${commands.join(" | ", )};`;
    
    const recognition = new SpeechRecognition();
    const speechGrammarList = new SpeechGrammarList();

    

    document.getElementById('microphone').addEventListener('click', (e) => {
        
        get_microphone_credentials();
        speechrecognition(document.getElementById('songbar'));
    });


    document.getElementById('microphone_1').addEventListener('click', (e) =>{

        get_microphone_credentials();
        speechrecognition(document.getElementById('artistbar'));
    });

    document.getElementById('microphone_2').addEventListener('click', (e)=>{

        get_microphone_credentials();
        speechrecognition(document.getElementById('emotionbar'));
    });


    function speechrecognition(input_text){

        speechGrammarList.addFromString(grammar, 1);
        speechGrammarList.continous = false;
        speechGrammarList.lang = "en-US";
        speechGrammarList.interimResults = false;
        speechGrammarList.maxAlternatives = 1;

        recognition.start();
        console.log("Recognition started ! Speak Following commands ", `${commands}`);
        console.log("Recognition status : Start");

        recognition.onresult = (event) =>{

                const command_transrcipt = event.results[0][0].transcript;
                document.getElementById('audio').innerHTML = `Command receive ${command_transrcipt}`;
                console.log("Confidence Level :", `${event.results[0][0].confidence}`);

                console.log("status ", `${event.results[0][0].transcript}`);

                if (`${event.results[0][0].transcript}`.startsWith("search ")){

                    input_text.value = `${event.results[0][0].transcript}`.replace("search ", " ");
                
                }else if (`${event.results[0][0].transcript}`.startsWith("artist ")){

                    input_text.value = `${event.results[0][0].transcript}`.replace("artist ", " ");

                }else if (`${event.results[0][0].transcript}`.startsWith("emotion ")){
    
                    input_text.value = `${event.results[0][0].transcript}`.replace("emotion ", " ");
                
                }else{

                    input_text.value = "This command does not register";

                }
                
        };

        recognition.onspeechend = (event) => {

            console.log("Recognition status : Stop");
            document.getElementById('audio').style.visibility = 'hidden';
            recognition.stop();
        };

        recognition.onnomatch = (event) => {

            document.getElementById('audio').innerHTML = `This command ${event.results[0][0].transcript} have any context with confidence ${event.results[0][0].confidence}`;
        
        };

        recognition.onerror = (event) => {

            document.getElementById('audio').innerHTML = `Error occurred in recognition: ${event.error}`;

        };
    }
    
    
 </script>
</body>
</html>